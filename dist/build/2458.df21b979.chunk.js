(self.webpackChunkcafedra=self.webpackChunkcafedra||[]).push([[2458],{49699:(x,v,e)=>{"use strict";e.d(v,{Z:()=>y});var t=e(45485),u=e(27875),l=e(10701),r=e(48102),a=e(17741),o=e(59082),g=e(76827),f=e(70627),s=e.n(f),h=e(61020),A=e(84352),n=e(92807);const d=({onRegenerate:T,idToRegenerate:R,backUrl:Z,onError:$})=>{const{formatMessage:S}=(0,h.Z)(),[P,B]=(0,t.useState)(!1),{regenerateData:D,isLoadingConfirmation:V}=(0,n.rW)(Z,R,T,$),b=async()=>{D(),B(!1)};return t.createElement(t.Fragment,null,t.createElement(r.z,{startIcon:t.createElement(A.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>B(!0),name:"regenerate"},S({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(a.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(A.Z,null),isConfirmButtonLoading:V,isOpen:P,onToggleDialog:()=>B(!1),onConfirm:b,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};d.defaultProps={onRegenerate(){},onError:void 0},d.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const i=d,p=({title:T,token:R,setToken:Z,canEditInputs:$,canRegenerate:S,isSubmitting:P,backUrl:B,regenerateUrl:D,onErrorRegenerate:V})=>{const{formatMessage:b}=(0,h.Z)(),Y=X=>{Z({...R,accessKey:X})};return t.createElement(u.T,{title:R?.name||b(T),primaryAction:$?t.createElement(l.k,{gap:2},S&&R?.id&&t.createElement(i,{backUrl:D,onRegenerate:Y,idToRegenerate:R?.id,onError:V}),t.createElement(r.z,{disabled:P,loading:P,startIcon:t.createElement(o.Z,null),type:"submit",size:"S"},b({id:"global.save",defaultMessage:"Save"}))):S&&R?.id&&t.createElement(i,{onRegenerate:Y,idToRegenerate:R?.id,backUrl:D}),navigationAction:t.createElement(a.rU,{startIcon:t.createElement(g.Z,null),to:B},b({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};p.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},p.defaultProps={token:void 0,onErrorRegenerate:void 0};const y=p},89982:(x,v,e)=>{"use strict";e.d(v,{Z:()=>h});var t=e(45485),u=e(5627),l=e(78955),r=e(32370),a=e(70627),o=e.n(a),g=e(61020),f=e(51352);const s=({token:A,errors:n,values:d,onChange:i,isCreating:p})=>{const{formatMessage:y}=(0,g.Z)();return t.createElement(t.Fragment,null,t.createElement(u.P,{name:"lifespan",label:y({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:d.lifespan!==null?d.lifespan:"0",error:n.lifespan?y(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:T=>{i({target:{name:"lifespan",value:T}})},required:!0,disabled:!p,placeholder:"Select"},t.createElement(l.W,{value:"604800000"},y({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(l.W,{value:"2592000000"},y({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(l.W,{value:"7776000000"},y({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(l.W,{value:"0"},y({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(r.Z,{variant:"pi",textColor:"neutral600"},!p&&`${y({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,f.IX)(A?.createdAt,parseInt(d.lifespan,10))}`))};s.propTypes={errors:o().shape({lifespan:o().string}),onChange:o().func.isRequired,values:o().shape({lifespan:o().oneOfType([o().number,o().string])}).isRequired,isCreating:o().bool.isRequired,token:o().shape({id:o().oneOfType([o().number,o().string]),type:o().string,lifespan:o().string,name:o().string,accessKey:o().string,permissions:o().array,description:o().string,createdAt:o().string})},s.defaultProps={errors:{},token:{}};const h=s},81384:(x,v,e)=>{"use strict";e.d(v,{Z:()=>h});var t=e(45485),u=e(4987),l=e(17741),r=e(78031),a=e(5368),o=e(70627),g=e.n(o),f=e(61020);const s=({token:A,tokenType:n})=>{const{formatMessage:d}=(0,f.Z)(),i=(0,l.lm)(),{trackUsage:p}=(0,l.rS)(),{copy:y}=(0,l.VP)(),T=R=>async()=>{await y(R)&&(p("didCopyTokenKey",{tokenType:n}),i({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(l.Y_,{endAction:A&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(u.h,{label:d({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:T(A),noBorder:!0,icon:t.createElement(r.Z,null),style:{padding:0,height:"1rem"}})),title:A||d({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:d(A?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:g().string,tokenType:g().string.isRequired};const h=s},37651:(x,v,e)=>{"use strict";e.d(v,{Z:()=>g});var t=e(45485),u=e(39708),l=e(70627),r=e.n(l),a=e(61020);const o=({errors:f,values:s,onChange:h,canEditInputs:A})=>{const{formatMessage:n}=(0,a.Z)();return t.createElement(u.g,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:f.description?n(f.description?.id?f.description:{id:f.description,defaultMessage:f.description}):null,onChange:h,disabled:!A},s.description)};o.propTypes={errors:r().shape({description:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({description:r().string}).isRequired},o.defaultProps={errors:{}};const g=o},72028:(x,v,e)=>{"use strict";e.d(v,{Z:()=>g});var t=e(45485),u=e(12881),l=e(70627),r=e.n(l),a=e(61020);const o=({errors:f,values:s,onChange:h,canEditInputs:A})=>{const{formatMessage:n}=(0,a.Z)();return t.createElement(u.o,{name:"name",error:f.name?n(f.name?.id?f.name:{id:f.name,defaultMessage:f.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:h,value:s.name,disabled:!A,required:!0})};o.propTypes={errors:r().shape({name:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string}).isRequired},o.defaultProps={errors:{}};const g=o},32381:(x,v,e)=>{"use strict";e.d(v,{Z:()=>f});var t=e(45485),u=e(5627),l=e(78955),r=e(70627),a=e.n(r),o=e(61020);const g=({name:s,errors:h,values:A,onChange:n,canEditInputs:d,options:i,label:p})=>{const{formatMessage:y}=(0,o.Z)();return t.createElement(u.P,{name:s,label:y({id:p.id,defaultMessage:p.defaultMessage}),value:A&&A[s],error:h[s]?y(h[s]?.id?h[s]:{id:h[s],defaultMessage:h[s]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!d},i&&i.map(({value:T,label:R})=>t.createElement(l.W,{key:T,value:T},y(R))))};g.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},g.defaultProps={name:"type",errors:{},options:[]};const f=g},81966:(x,v,e)=>{"use strict";e.d(v,{Z:()=>t,f:()=>u});const t="api-token",u="transfer-token"},92458:(x,v,e)=>{"use strict";e.d(v,{Z:()=>Ge});var t=e(45485),u=e(9941),l=e(74758),r=e(10701),a=e(17741),o=e(71563),g=e(61020),f=e(40464),s=e(49402),h=e(51447),A=e(70627),n=e.n(A);const d=(0,t.createContext)({}),i=({children:c,...m})=>t.createElement(d.Provider,{value:m},c),p=()=>(0,t.useContext)(d);i.propTypes={children:n().node.isRequired};var y=e(96854),T=e(36364),R=e(81966),Z=e(49699),$=e(81384),S=e(93415),P=e(32370),B=e(23298),D=e(74577),V=e(89982),b=e(37651),Y=e(72028),X=e(32381);const J=({errors:c,onChange:m,canEditInputs:E,isCreating:I,values:M,apiToken:k,onDispatch:O,setHasChangedPermissions:z})=>{const{formatMessage:j}=(0,g.Z)(),F=({target:{value:H}})=>{z(!1),H==="full-access"&&O({type:"SELECT_ALL_ACTIONS"}),H==="read-only"&&O({type:"ON_CHANGE_READ_ONLY"})},w=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(P.Z,{variant:"delta",as:"h2"},j({id:"global.details",defaultMessage:"Details"})),t.createElement(B.r,{gap:5},t.createElement(D.P,{key:"name",col:6,xs:12},t.createElement(Y.Z,{errors:c,values:M,canEditInputs:E,onChange:m})),t.createElement(D.P,{key:"description",col:6,xs:12},t.createElement(b.Z,{errors:c,values:M,canEditInputs:E,onChange:m})),t.createElement(D.P,{key:"lifespan",col:6,xs:12},t.createElement(V.Z,{isCreating:I,errors:c,values:M,onChange:m,token:k})),t.createElement(D.P,{key:"type",col:6,xs:12},t.createElement(X.Z,{values:M,errors:c,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:H=>{F({target:{value:H}}),m({target:{name:"type",value:H}})},options:w,canEditInputs:E})))))};J.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},J.defaultProps={errors:{},apiToken:{}};const Q=J;var ne=e(27875),le=e(48102),ve=e(59082);const _=({apiTokenName:c})=>{const{formatMessage:m}=(0,g.Z)();return(0,a.go)(),t.createElement(u.o,{"aria-busy":"true"},t.createElement(a.SL,{name:"API Tokens"}),t.createElement(ne.T,{primaryAction:t.createElement(le.z,{disabled:!0,startIcon:t.createElement(ve.Z,null),type:"button",size:"L"},m({id:"global.save",defaultMessage:"Save"})),title:c||m({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(l.D,null,t.createElement(a.dO,null)))};_.defaultProps={apiTokenName:null},_.propTypes={apiTokenName:n().string};const de=_;var ce=e(58422),se=e.n(ce),ae=e(34049),oe=e.n(ae),re=e(72450);const Me=c=>{switch(c){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Oe=(0,re.default)(S.x)`
  margin: -1px;
  border-radius: ${({theme:c})=>c.spaces[1]} 0 0 ${({theme:c})=>c.spaces[1]};
`;function pe({route:c}){const{formatMessage:m}=(0,g.Z)(),{method:E,handler:I,path:M}=c,k=M?oe()(M.split("/")):[],[O="",z=""]=I?I.split("."):[],j=Me(c.method);return t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.Z,{variant:"delta",as:"h3"},m({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,O),t.createElement(P.Z,{variant:"delta",textColor:"primary600"},".",z)),t.createElement(r.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(Oe,{background:j.background,borderColor:j.border,padding:2},t.createElement(P.Z,{fontWeight:"bold",textColor:j.text},E)),t.createElement(S.x,{paddingLeft:2,paddingRight:2},se()(k,F=>t.createElement(P.Z,{key:F,textColor:F.includes(":")?"neutral600":"neutral900"},"/",F)))))}pe.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},pe.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Re=pe,xe=()=>{const{value:{selectedAction:c,routes:m}}=p(),{formatMessage:E}=(0,g.Z)(),I=c?.split(".")[0];return t.createElement(D.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},c?t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},m[I]?.map(M=>M.config.auth?.scope?.includes(c)||M.handler===c?t.createElement(Re,{key:M.handler,route:M}):null)):t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.Z,{variant:"delta",as:"h3"},E({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(P.Z,{as:"p",textColor:"neutral600"},E({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var De=e(45322),Ie=e(24920),Se=e(34642),Ae=e(22572),ke=e(35318),Le=e(98344),Be=e.n(Le);const Ce=(0,re.css)`
  background: ${c=>c.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,re.default)(S.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${c=>c.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${c=>c.isActive&&Ce}
  &:hover {
    ${Ce}
  }
`,We=re.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:c})=>c.colors.neutral150};
`,ue=({controllers:c,label:m,orderNumber:E,disabled:I,onExpanded:M,indexExpandendCollapsedContent:k})=>{const{value:{onChangeSelectAll:O,onChange:z,selectedActions:j,setSelectedAction:F,selectedAction:w}}=p(),[H,ie]=(0,t.useState)(!1),{formatMessage:Ee}=(0,g.Z)(),q=()=>{ie(L=>!L),M(E)};(0,t.useEffect)(()=>{k!==null&&k!==E&&H&&ie(!1)},[k,E,H]);const W=L=>L===w;return t.createElement(De.U,{expanded:H,onToggle:q,variant:E%2?"primary":"secondary"},t.createElement(Ie.B,{title:Be()(m)}),t.createElement(Se.v,null,c?.map(L=>{const ee=L.actions.every(K=>j.includes(K.actionId)),fe=L.actions.some(K=>j.includes(K.actionId));return t.createElement(S.x,{key:`${m}.${L?.controller}`},t.createElement(r.k,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(S.x,{paddingRight:4},t.createElement(P.Z,{variant:"sigma",textColor:"neutral600"},L?.controller)),t.createElement(We,null),t.createElement(S.x,{paddingLeft:4},t.createElement(Ae.X,{value:ee,indeterminate:!ee&&fe,onValueChange:()=>{O({target:{value:[...L.actions]}})},disabled:I},Ee({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(B.r,{gap:4,padding:4},L?.actions&&L?.actions.map(K=>t.createElement(D.P,{col:6,key:K.actionId},t.createElement(Ue,{isActive:W(K.actionId),padding:2,hasRadius:!0},t.createElement(Ae.X,{value:j.includes(K.actionId),name:K.actionId,onValueChange:()=>{z({target:{value:K.actionId}})},disabled:I},K.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>F({target:{value:K.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(ke.Z,null)))))))})))};ue.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ue.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ze=ue,ge=({section:c,...m})=>{const[E,I]=(0,t.useState)(null),M=k=>I(k);return t.createElement(S.x,{padding:4,background:"neutral0"},c&&c.map((k,O)=>t.createElement(Ze,{key:k.apiId,label:k.label,controllers:k.controllers,orderNumber:O,indexExpandendCollapsedContent:E,onExpanded:M,name:k.apiId,...m})))};ge.defaultProps={section:null},ge.propTypes={section:n().arrayOf(n().object)};const be=ge,Ke=({...c})=>{const{value:{data:m}}=p(),{formatMessage:E}=(0,g.Z)();return t.createElement(B.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(D.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.Z,{variant:"delta",as:"h2"},E({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(P.Z,{as:"p",textColor:"neutral600"},E({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),m?.permissions&&t.createElement(be,{section:m?.permissions,...c})),t.createElement(xe,null))},$e=(0,t.memo)(Ke);var me=e(51352);const Ne=(c,m=[])=>({...c,selectedAction:null,routes:[],selectedActions:[],data:(0,me.mk)(m)});var je=e(61815),Fe=e(22009),Pe=e.n(Fe);const He={data:{},selectedActions:[]},Ve=(c,m)=>(0,je.ZP)(c,E=>{switch(m.type){case"ON_CHANGE":{E.selectedActions.includes(m.value)?Pe()(E.selectedActions,m.value):E.selectedActions.push(m.value);break}case"SELECT_ALL_IN_PERMISSION":{m.value.every(M=>E.selectedActions.includes(M.actionId))?m.value.forEach(M=>{Pe()(E.selectedActions,M.actionId)}):m.value.forEach(M=>{E.selectedActions.push(M.actionId)});break}case"SELECT_ALL_ACTIONS":{E.selectedActions=[...E.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=E.data.allActionsIds.filter(M=>M.includes("find")||M.includes("findOne"));E.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{E.data=(0,me.mk)(m.value);break}case"UPDATE_ROUTES":{E.routes={...m.value};break}case"UPDATE_PERMISSIONS":{E.selectedActions=[...m.value];break}case"SET_SELECTED_ACTION":{E.selectedAction=m.value;break}default:return E}}),ze="Name already taken",Ge=()=>{(0,a.go)();const{formatMessage:c}=(0,g.Z)(),{lockApp:m,unlockApp:E}=(0,a.o1)(),I=(0,a.lm)(),M=(0,h.k6)(),k=(0,s.v9)(T._),[O,z]=(0,t.useState)(M.location.state?.apiToken.accessKey?{...M.location.state.apiToken}:null),{trackUsage:j}=(0,a.rS)(),F=(0,t.useRef)(j),{setCurrentStep:w}=(0,a.c1)(),{allowedActions:{canCreate:H,canUpdate:ie,canRegenerate:Ee}}=(0,a.ss)(k.settings["api-tokens"]),[q,W]=(0,t.useReducer)(Ve,He,C=>Ne(C,{})),{params:{id:L}}=(0,h.$B)("/settings/api-tokens/:id"),{get:ee,post:fe,put:K}=(0,a.kY)(),N=L==="create";(0,f.useQuery)("content-api-permissions",async()=>{const[C,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async te=>{const{data:U}=await ee(te);return U.data}));W({type:"UPDATE_PERMISSIONS_LAYOUT",value:C}),W({type:"UPDATE_ROUTES",value:G}),O&&(O?.type==="read-only"&&W({type:"ON_CHANGE_READ_ONLY"}),O?.type==="full-access"&&W({type:"SELECT_ALL_ACTIONS"}),O?.type==="custom"&&W({type:"UPDATE_PERMISSIONS",value:O?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{F.current(N?"didAddTokenFromList":"didEditTokenFromList",{tokenType:R.Z})},[N]);const{status:Ye}=(0,f.useQuery)(["api-token",L],async()=>{const{data:{data:C}}=await ee(`/admin/api-tokens/${L}`);return z({...C}),C?.type==="read-only"&&W({type:"ON_CHANGE_READ_ONLY"}),C?.type==="full-access"&&W({type:"SELECT_ALL_ACTIONS"}),C?.type==="custom"&&W({type:"UPDATE_PERMISSIONS",value:C?.permissions}),C},{enabled:!N&&!O,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Xe=async(C,G)=>{F.current(N?"willCreateToken":"willEditToken",{tokenType:R.Z}),m();const te=C.lifespan&&parseInt(C.lifespan,10)&&C.lifespan!=="0"?parseInt(C.lifespan,10):null;try{const{data:{data:U}}=N?await fe("/admin/api-tokens",{...C,lifespan:te,permissions:C.type==="custom"?q.selectedActions:null}):await K(`/admin/api-tokens/${L}`,{name:C.name,description:C.description,type:C.type,permissions:C.type==="custom"?q.selectedActions:null});N&&(M.replace(`/settings/api-tokens/${U.id}`,{apiToken:U}),w("apiTokens.success")),E(),z({...U}),I({type:"success",message:c(N?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),F.current(N?"didCreateToken":"didEditToken",{type:O.type,tokenType:R.Z})}catch(U){const Te=(0,y.Iz)(U.response.data);G.setErrors(Te),U?.response?.data?.error?.message===ze?I({type:"warning",message:U.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:U?.response?.data?.message||"notification.error"}),E()}},[Qe,ye]=(0,t.useState)(!1),Je={...q,onChange:({target:{value:C}})=>{ye(!0),W({type:"ON_CHANGE",value:C})},onChangeSelectAll:({target:{value:C}})=>{ye(!0),W({type:"SELECT_ALL_IN_PERMISSION",value:C})},setSelectedAction:({target:{value:C}})=>{W({type:"SET_SELECTED_ACTION",value:C})}},he=ie&&!N||H&&N;return!N&&!O&&Ye!=="success"?t.createElement(de,{apiTokenName:O?.name}):t.createElement(i,{value:Je},t.createElement(u.o,null,t.createElement(a.SL,{name:"API Tokens"}),t.createElement(o.J9,{validationSchema:me.fK,validateOnChange:!1,initialValues:{name:O?.name||"",description:O?.description||"",type:O?.type,lifespan:O?.lifespan?O.lifespan.toString():O?.lifespan},enableReinitialize:!0,onSubmit:(C,G)=>Xe(C,G)},({errors:C,handleChange:G,isSubmitting:te,values:U,setFieldValue:Te})=>(Qe&&U?.type!=="custom"&&Te("type","custom"),t.createElement(a.l0,null,t.createElement(Z.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:O,setToken:z,canEditInputs:he,canRegenerate:Ee,isSubmitting:te,regenerateUrl:"/admin/api-tokens/"}),t.createElement(l.D,null,t.createElement(r.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(O?.name)&&t.createElement($.Z,{token:O?.accessKey,tokenType:R.Z}),t.createElement(Q,{errors:C,onChange:G,canEditInputs:he,isCreating:N,values:U,apiToken:O,onDispatch:W,setHasChangedPermissions:ye}),t.createElement($e,{disabled:!he||U?.type==="read-only"||U?.type==="full-access"}))))))))}},51352:(x,v,e)=>{"use strict";e.d(v,{IX:()=>a,fK:()=>s,mk:()=>A});var t=e(40998),u=e(1851),l=e(90765);const a=(n,d,i="en")=>{if(d&&typeof d=="number"){const p=d/24/60/60/1e3;return(0,t.Z)((0,u.Z)(new Date(n),p),"PPP",{locale:l[i]})}return"Unlimited"};var o=e(17741),g=e(47853);const s=g.Ry().shape({name:g.Z_(o.I0.string).max(100).required(o.I0.required),type:g.Z_(o.I0.string).oneOf(["read-only","full-access","custom"]).required(o.I0.required),description:g.Z_().nullable(),lifespan:g.Rx().integer().min(0).nullable().defined(o.I0.required)}),A=n=>{const d={allActionsIds:[],permissions:[]};return d.permissions=Object.keys(n).map(i=>({apiId:i,label:i.split("::")[1],controllers:Object.keys(n[i].controllers).map(p=>({controller:p,actions:n[i].controllers[p].map(y=>{const T=`${i}.${p}.${y}`;return i.includes("api::")&&d.allActionsIds.push(T),{action:y,actionId:T}}).flat()})).flat()})),d}},1786:x=>{function v(e,t,u,l){for(var r=u-1,a=e.length;++r<a;)if(l(e[r],t))return r;return-1}x.exports=v},12186:(x,v,e)=>{var t=e(36393),u=e(62878),l=e(1786),r=e(20435),a=e(22033),o=Array.prototype,g=o.splice;function f(s,h,A,n){var d=n?l:u,i=-1,p=h.length,y=s;for(s===h&&(h=a(h)),A&&(y=t(s,r(A)));++i<p;)for(var T=0,R=h[i],Z=A?A(R):R;(T=d(y,Z,T,n))>-1;)y!==s&&g.call(y,T,1),g.call(s,T,1);return s}x.exports=f},58422:(x,v,e)=>{var t=e(36393),u=e(90040),l=e(92403),r=e(26126);function a(o,g){var f=r(o)?t:l;return f(o,u(g,3))}x.exports=a},22009:(x,v,e)=>{var t=e(52431),u=e(45906),l=t(u);x.exports=l},45906:(x,v,e)=>{var t=e(12186);function u(l,r){return l&&l.length&&r&&r.length?t(l,r):l}x.exports=u},34049:(x,v,e)=>{var t=e(20454);function u(l){var r=l==null?0:l.length;return r?t(l,1,r):[]}x.exports=u},45322:(x,v,e)=>{"use strict";e.d(v,{U:()=>n,y:()=>h});var t=e(74081),u=e(45485),l=e(72450),r=e(39267),a=e(74513),o=e(32370),g=e(10701),f=e(93415);const s=({theme:d,expanded:i,variant:p,disabled:y,error:T})=>T?`1px solid ${d.colors.danger600} !important`:y?`1px solid ${d.colors.neutral150}`:i?`1px solid ${d.colors.primary600}`:p==="primary"?`1px solid ${d.colors.neutral0}`:`1px solid ${d.colors.neutral100}`,h=(0,l.default)(o.Z)``,A=(0,l.default)(f.x)`
  border: ${s};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:d})=>d.colors.primary600};

    ${h} {
      color: ${({theme:d,expanded:i})=>i?void 0:d.colors.primary700};
    }

    ${o.Z} {
      color: ${({theme:d,expanded:i})=>i?void 0:d.colors.primary600};
    }

    & > ${g.k} {
      background: ${({theme:d})=>d.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:d})=>d.colors.primary200};
    }
  }
`,n=({children:d,disabled:i=!1,error:p,expanded:y=!1,hasErrorMessage:T=!0,id:R,onToggle:Z,toggle:$,size:S="M",variant:P="primary",shadow:B})=>{const D=(0,a.M)(R),V=u.useMemo(()=>({expanded:y,onToggle:Z,toggle:$,id:D,size:S,variant:P,disabled:i}),[i,y,D,Z,S,$,P]);return(0,t.jsxs)(r.S.Provider,{value:V,children:[(0,t.jsx)(A,{"data-strapi-expanded":y,disabled:i,"aria-disabled":i,expanded:y,hasRadius:!0,variant:P,error:p,shadow:B,children:d}),p&&T&&(0,t.jsx)(f.x,{paddingTop:1,children:(0,t.jsx)(o.Z,{variant:"pi",textColor:"danger600",children:p})})]})}},34642:(x,v,e)=>{"use strict";e.d(v,{v:()=>r});var t=e(74081),u=e(39267),l=e(93415);const r=({children:a,...o})=>{const{expanded:g,id:f}=(0,u.A)();if(!g)return null;const s=`accordion-content-${f}`,h=`accordion-label-${f}`,A=`accordion-desc-${f}`;return(0,t.jsx)(l.x,{role:"region",id:s,"aria-labelledby":h,"aria-describedby":A,...o,children:a})}},39267:(x,v,e)=>{"use strict";e.d(v,{A:()=>l,S:()=>u});var t=e(45485);const u=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),l=()=>(0,t.useContext)(u)},24920:(x,v,e)=>{"use strict";e.d(v,{B:()=>d});var t=e(74081),u=e(10411),l=e(72450),r=e(45322),a=e(39267);const o=({expanded:i,disabled:p,variant:y})=>{let T="neutral100";return i?T="primary100":p?T="neutral150":y==="primary"&&(T="neutral0"),T};var g=e(1782),f=e(50703),s=e(10701),h=e(32370);const A=(0,l.default)(g.A)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:i,expanded:p})=>p?i.colors.primary600:i.colors.neutral500};
    }
  }
`,n=(0,l.default)(s.k)`
  min-height: ${({theme:i,size:p})=>i.sizes.accordions[p]};
  border-radius: ${({theme:i,expanded:p})=>p?`${i.borderRadius} ${i.borderRadius} 0 0`:i.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:i})=>i.colors.primary600};
      }
    }
  }
`,d=({title:i,description:p,as:y="span",togglePosition:T="right",action:R,...Z})=>{const{onToggle:$,toggle:S,expanded:P,id:B,size:D,variant:V,disabled:b}=(0,a.A)(),Y=`accordion-content-${B}`,X=`accordion-label-${B}`,J=`accordion-desc-${B}`,Q=D==="M"?6:4,ne=D==="M"?Q:Q-2,le=o({expanded:P,disabled:b,variant:V}),_={as:y,fontWeight:D==="S"?"bold":void 0,id:X,textColor:P?"primary600":"neutral700",ellipsis:!0,variant:D==="M"?"delta":void 0},de=P?"primary600":"neutral600",ce=P?"primary200":"neutral200",se=D==="M"?`${32/16}rem`:`${24/16}rem`,ae=()=>{b||(S&&!$?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),S()):$&&$())},oe=(0,t.jsx)(s.k,{justifyContent:"center",borderRadius:"50%",height:se,width:se,transform:P?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:b?"not-allowed":"pointer",onClick:ae,shrink:0,children:(0,t.jsx)(f.J,{as:u.Z,width:D==="M"?`${11/16}rem`:`${8/16}rem`,color:P?"primary600":"neutral600"})});return(0,t.jsx)(n,{paddingBottom:ne,paddingLeft:Q,paddingRight:Q,paddingTop:ne,background:le,expanded:P,size:D,justifyContent:"space-between",cursor:b?"not-allowed":"",children:(0,t.jsxs)(s.k,{gap:3,flex:1,maxWidth:"100%",children:[T==="left"&&oe,(0,t.jsx)(A,{onClick:ae,"aria-disabled":b,"aria-expanded":P,"aria-controls":Y,"aria-labelledby":X,"data-strapi-accordion-toggle":!0,expanded:P,type:"button",flex:1,minWidth:0,...Z,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.y,{..._,children:i}),p&&(0,t.jsx)(h.Z,{as:"p",id:J,textColor:de,children:p})]})}),T==="right"&&(0,t.jsxs)(s.k,{gap:3,children:[oe,R]}),T==="left"&&R]})})}}}]);
